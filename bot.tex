% This is LLNCS.DEM the demonstration file of
% the LaTeX macro package from Springer-Verlag
% for Lecture Notes in Computer Science,
% version 2.4 for LaTeX2e as of 16. April 2010
\documentclass{llncs}

\usepackage[cmex10]{amsmath}
\usepackage{amssymb, amsfonts}

%\usepackage{natbib}
\usepackage{array,multirow}
\usepackage{color, colortbl}
\usepackage{makeidx}  
\usepackage{rotating}
\usepackage{graphicx}

\definecolor{col1}{rgb}{0.988,0.839,0.571}
\definecolor{col2}{rgb}{0.886,0.886,0.555}
\definecolor{col3}{rgb}{0.582,0.661,0.976}
\definecolor{white}{rgb}{1,1,1}

\graphicspath{{./Figures/},{./Figures/OasisCor/},{./Figures/OasisRegression/},{./Figures/Ellipse/}}
\DeclareGraphicsExtensions{.pdf,.png}



\newcommand{\cost}[0]{\mathtt{c}}
\newcommand{\couplingcost}[0]{\mathtt{cost}}
\newcommand{\coupling}[0]{\pi}
\newcommand{\couplings}[0]{\mathcal{C}}
\def\argmin{\mathop{\rm argmin}}
\newcommand{\dimX}{\mathtt{d}}
\newcommand{\Xsp}{{\mathbf{X}}}
\newcommand{\Ysp}{{\mathbf{Y}}}
\newcommand{\lambdaX}{\lambda^\Xsp}
\newcommand{\lambdaY}{\lambda^\Ysp}
\newcommand{\Cjk}{C_{j,k}}
\newcommand{\CjkX}{C^\Xsp_{j,k}}
\newcommand{\CjkY}{C^\Ysp_{j,k}}
\newcommand{\psijkX}{\psi^\Xsp_{j,k}}
\newcommand{\psijkY}{\psi^\Ysp_{j,k}}

%%% Contributions
% Unbalanced -> Mass imbalance is captured
% Split gray and white matter

%%% Things to fix
% More explanation on figures
% Clarify that we work on white matter and gray matter masks

\begin{document}

\title{Exploratory Population Analysis with Unbalanced Optimal Transport}
\titlerunning{Exploratory Population Analysis with Unbalanced Optimal Transport}  

\author{***, ***, ***, ***, ***}%Samuel Gerber, Marc Niethammer, Martin Styner, Stephen Aylward}
\authorrunning{***}%Gerber et al.} 
\institute{***\\%Kitware Inc, Carborro NC 27510, USA,\\
\email{***@***.**}%samuel.gerber@kitware.com}
\and
***%University of North Carolina, Chapel Hill NC 27504, USA}
}

\maketitle              

% What problems are we addressing?
%  - [MRI] disentangle mass from shape changes
%  - [MRI] No segmentations needed
%  - [VESSELS] unstructured point clouds
%  - [VESSELS] background blood perfusion

% What's new?
%  - Hypothesis generation
%  - Different measure to capture changes
%  - No deformable registration
%  - No parameter tuning
%  - [MRI] Unbalanced mass transport
%  - [VESSELS] Decomposition of transport plan with respect to underlying measure


\begin{abstract}
The plethora of data from neuroimaging studies provide a rich opportunity to
discover effects and generate hypotheses through exploratory data analysis.
Brain pathologies often manifest in changes in shape along with deterioration
and alteration of brain matter, i.e., changes in mass. We propose to use
unbalanced optimal transport to disentangle shape from mass changes and
localize those changes. The exploratory analysis approach generates images of
transport cost and mass changes for each subject in the population.  Using
voxelwise correlations with disease indicators on these images highlight
regions of mass or shape changes related to the disease indicator.  We
demonstrate the method on the white and gray matter segmentations from the
OASIS brain MRI data set, which includes subject ranging from healthy to mild
and moderate dementia. The results corroborate known pathology changes related
to dementia and suggest avenues for further clinical research. Additionally
regression and permutation testing on the transport cost and mass change images
improve on existing methods to predict disease measures and indicates that the
proposed method captures a larger portion of pathology induced changes.
\end{abstract}



\section{Introduction}
Neurological disease and disorder manifest in subtle and varied changes in
brain anatomy that can be non-local in nature and effect amounts of white and
gray matter as well as relative positioning and shapes of local brain anatomy.
To detect and quantify these changes is a primary goal of morphometry based
population analysis. We propose a morphometry approach based on unbalanced
optimal transport that yields a voxelwise comparison that explicitly separates
changes in matter volume from changes in matter location of and can take into
account non-local changes. The proposed unbalanced transport morphometry (UTM)
can detect global and regional deterioration of matter. 

Optimal transport, as the name implies, solves the problem of transporting mass
from a probability measure $\mu$ to a probability measure $\nu$, such that the
cost of moving mass from the source $\mu$ to the target $\nu$ is minimized.
Unbalanced optimal transport extends optimal transport to measures that do not
need to have equal mass by adding a mechanism to add and remove mass
into the optimization problem. The solution of the unbalanced optimal transport
yields a transport plan, or coupling, that measures how much mass is moved or
added and removed between source and target locations. We decompose these
transport plans to measure for each subject, at each voxel, mass allocations and
costs of mass transfer. These two measures explicitly separate changes due to
difference in amount of matter from differences due to changes in relative
position and shape of anatomies. 

Voxel-based morphometry (VBM)~\cite{ashburner1998identifying} yields spatially
localized changes in brain anatomy but has difficulty in discovering regionally
or globally occurring changes. Figure~\ref{fig:cor-ellipse} demonstrate the
capability of UTM to detect changes in size on a toy example of a hundred
half--ellipses with different ellipticity and thickness.  Correlating the
derived measures from UTM with either shape or size of the half--ellipses shows
that the proposed method is capable of correctly attributing changes to either
variation in shape or size.  Traditional VBM  results in weak correlation with
changes in size and cannot attribute the source of the changes to size or
shifts in positions.

\begin{figure}[t!]
\scriptsize
\centering
%\begin{tabular}{l}
\begin{tabular}{ll}
\begin{tabular}{lccc}
  \raisebox{2.5mm}{\rotatebox[origin=c]{90}{ $ \longrightarrow $ } }&
\includegraphics[width=0.1\linewidth]{illustration-01-01} &
\includegraphics[width=0.1\linewidth]{illustration-02-01} &
\includegraphics[width=0.1\linewidth]{illustration-03-01} \\
  \raisebox{2.5mm}{\rotatebox[origin=c]{90}{ Size } }&
\includegraphics[width=0.1\linewidth]{illustration-01-02} &
\includegraphics[width=0.1\linewidth]{illustration-02-02} &
\includegraphics[width=0.1\linewidth]{illustration-03-02} \\
  \raisebox{2.5mm}{\rotatebox[origin=c]{90}{ $ \longleftarrow $ }} &
\includegraphics[width=0.1\linewidth]{illustration-01-03} &
\includegraphics[width=0.1\linewidth]{illustration-02-03} &
\includegraphics[width=0.1\linewidth]{illustration-03-03} \\
  & $ \longleftarrow $ & Shape & $ \longrightarrow $ \\
\end{tabular}
        &
\begin{tabular}{r}
\begin{tabular}{lrcr}
 Pearson's r  &-0.9 & \includegraphics[width=0.4\linewidth]{colorbar} & 0.9
\end{tabular}\\
\begin{tabular}{l|c|c|c}
%\rowcolor{col3}\\ 
        \hline 
  \rotatebox[origin=c]{90}{ VBM } &
  \raisebox{-3mm}{\includegraphics[width=0.18\linewidth]{cor-mass-intensity}} &
  \raisebox{-3mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-intensity} }&
  \raisebox{-3mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-mass-intensity}} \\ \hline
%\rowcolor{col1}
   \raisebox{1mm}{\rotatebox[origin=c]{90}{Cost}}&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-mass-cost} }&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-cost} }&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-mass-cost} } \\
  %
  \raisebox{1mm}{\rotatebox[origin=c]{90}{Mass}}&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-mass-mass-border} }&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-mass} }&
  \raisebox{-2mm}{\includegraphics[width=0.18\linewidth]{cor-rx-ry-mass-mass} }\\ \hline 
%\rowcolor{white}
	& cor( Size ) 
	& cor( Shape )
	& cor(Shape + Size)
\end{tabular}\\
\end{tabular}\\
  (I) & (II) \\
\end{tabular}
%\begin{tabular}{c|c|c|r}
%\includegraphics[width=0.25\linewidth]{hist-mass} &
%\includegraphics[width=0.25\linewidth]{hist-ellipticity} &
%\includegraphics[width=0.25\linewidth]{hist-additive} &
%\includegraphics[width=0.15\linewidth]{legend} 
%  \\ \hline 
%	(a') Size & (b') Shape & (c') Shape + Size &
%\end{tabular}\\
%  (III)
%\end{tabular}
\caption{\label{fig:cor-ellipse}
(I) Illustration of unbalanced optimal transport on a toy data set of a 100
half ellipses with different shapes (minor, major radii) and sizes (thickness).
(II) Spatial correlations of (a) size (number of black pixels), (b) shape
(ratio of the minor and major radii) and (c) sum of size and shape to pixel
intensity values (VBM) , TBM mass allocation and TBM transport costs. Positive
and negative correlation indicate an increase and decrease of mass, cost, or
intensity, respectively. Only UTM is able to detect the size covariate
(highlighted box) as positively correlated in all locations and with much
stronger correlation than VBM.  Both UTM and VMB detect the change in shape and
UTM correctly attributes mostly to transport cost. UTM also correctly identifies
a decomposition of a covariate that depends on both shape and size. 
%(III) Smoothed counts of Pearson's r correlation from the spatial
%correlations. The proposed method correctly identifies shape versus mass
%effects and leads to stronger correlations.  
\vspace{-7mm}
}
\end{figure}

Deformation-based morphometry (DBM)~\cite{ashburner1998identifying} addresses
the issue of finding global effects by comparing the parameters of non-linear
spatial normalization to a template.  DBM results, typically shown as modes of
variation, are more difficult to visualize and interpret.  UTM combines the
strengths of VBM and DBM methods.  While the results are based on a voxelwise
analysis and easily interpretable, the quantities compared stem from a global
optimization problem which can detect global and regional effects and adds
separation of a effects due to changes in volume from effects due to changes in
location or shape. 

A key observation is that VBM, TBM and DBM are driven by local image gradients
and voxelwise measures ultimately lead to very similar
results~\cite[Chaper~6]{frackowiak2004human}.  UTM solves a global optimization
problem based on the distribution of mass and the allocation of mass is not
driven by image gradients. Thus, allocation of mass can be diffuse over a large
region without the need for a smooth spatial normalization to distribute the
image gradient driven warp over a larger region. 

VBM has been shown to be sensitive to the particulars of the spatial
normalization~\cite{bookstein2001voxel,davatzikos2004voxel}. UTM still depends
on a rigid spatial normalization to bring the subjects into a common coordinate
system were voxelwise comparisons are feasible. However, the optimal transport
is insensitive to small miss-alignments in the spatial normalization step.
Small shifts in mass locations incur only small costs, while for VBM, TBM and
DBM a small shift either introduces a large difference in pixel intensity or
can introduce large local deformations.  After the spatial normalization the
optimal transport derived measures do no depend on a template but instead are
based on averaging pairwise transport plans, which will alleviate bias due to
registrations to a single template. 

%Section~\ref{sec:methods} describes unbalanced optimal transport and the
%construction of mass allocation and transport cost images
%Section~\ref{sec:results} demonstrate UTM on white and gray matter masks of the
%OASIS brain data set~\cite{marcus2010open}. 

The key contributions of this work are:
\vspace{-1mm}
\begin{enumerate}
\item A voxel-wise morphometry approach that is capable of detecting regional
  or global changes and is insensitive to small spatial misalignments.
\item A formulation of unbalanced otimal transport to detect changes in mass as
  well as changes in shape and relative position (Section~\ref{sec:methods}).
\item Application of optimal transport to gray and white matter masks
  individally to avoid trnasport accross tissues and avoid incomesurable
  measurements across subjects in MRI intensities (Section~\ref{sec:results}).
\item Demonstration of the importance of incororating mass imbalances to detect
  changes in brain anatomy (Section~\ref{sec:results}).  
\end{enumerate}

\section{Related Work}


Recent advances in the computation of optimal transport
plans~\cite{cuturi2013sinkhorn,gerber2017multiscale} paved the way for a flurry
in machine learning and applications to medical image analysis. In particular,
Kundu et. al.~\cite{kundu2018discovery} formulate a DBM approach, TrBM, which
replaces non-linear warps by optimal transport maps and Gramfort et.
al.~\cite{gramfort2015fast} use optimal transport for improved averaging of
neuroimaging data. 

UTM presents a different approach from TrBM to integrate optimal transport into
morphometric analysis. TrBM yields a parametrization of the transport plans
akin to DBM that captures global changes. UTM uses the transport plan to create
voxelwise measures and incorporates mass imbalances into the transport plans.
TrBM was applied to graylevel MRI intensities, we choose to use the gray and
white matter masks instead of MRI intensity values to avoid conversion of white
to gray matter in the optimal transport optimization and to avoid difficulties
in normalizing MRI intensities across subjects. 



\section{Unbalanced Optimal Transport Morphometry}
\label{sec:methods}
Morphometry with unbalanced optimal transport follows the standard morphometry
pipeline, but performs voxelwise statistical analysis on the mass allocation
and transport cost maps derived from the solution of unbalanced optimal
transport between the subjects.

Section~\ref{sec:unbalanced} describes the unbalanced optimal transport problem
and Section~\ref{sec:mass} the construction of the mass allocation and
transport cost maps for each subject.

\subsection{Unbalanced Optimal Transport}
\label{sec:unbalanced}
For two probability measures $\mu$ and $\nu$ on probability spaces ${\Xsp}$
and ${\Ysp}$ respectively, a coupling of $\mu$ and $\nu$ is a measure
$\coupling$ on ${\Xsp}\times{\Ysp}$ such that the marginals of $\coupling$ are
$\mu$ and $\nu$. The coupling $\coupling$ defines a {\em transport plan} that
captures how much mass is transport from any $x \in \Xsp$ to  any $y \in \Ysp$
by $\coupling(x, y)$. To define optimal transport and optimal couplings, we
need a cost function $\cost(x,y)$ on ${\Xsp}\times{\Ysp}$ representing the work
or cost needed to move a unit of mass from $x$ to $y$. An optimal coupling
$\coupling^*$ minimizes this cost over all choices of couplings
$\mathcal{C}(\mu,\nu)$ between
$\mu$ and $\nu$: 
\begin{equation}
  \coupling^*= \argmin_{\coupling\in\mathcal{C}(\mu,\nu)} \int_{{\Xsp}}\int_{{\Ysp}}
\cost(x,y)  d\coupling(x,y) \,.  
\end{equation}

For discrete distributions $\mu = \sum_1^n w(x_i) \delta(x_i)$ and $ \nu =
\sum_1^m v(y_i) \delta(y_i)$ with $\sum w(x_i) = \sum v(y_i) = 1$ the optimal
transport problem can be solved by linear programming. To extend the
formulation to deal with arbitrary positive measures $\mu$ and $\nu$ with mass
imbalance  $\Delta = \sum_1^n v(y_i)  - \sum_1^m w(x_i)$, the linear program is
modified to allow for the creation of mass at locations $x_i$ by adding a new
source location $z$ and target location and constraints that amount to adding
or removing at most $v(x_i)$ to any target location $y_i$ for free. With these
modifications the linear program to solve is: 
\begin{equation}
\min_\coupling \sum_{\substack{i=1,\dots,n\\ j=1,\dots,m}} 
      \cost(x_i, y_j) \coupling(x_i, y_j) \quad \text{s.t.}\quad 
\begin{cases}
  \sum_j \coupling(x_i, y_j)  = \mu(\{x_i\}) = w(x_i) & \\ 
  \sum_i \coupling(x_i, y_j) + \coupling(z, y_j)= \nu(\{y_j\}) = v(y_j) & \\
  \sum_j \coupling(z, y_j)  = \Delta \\
  \coupling(x_i, y_j) \ge 0 \\
\end{cases}\,.
\label{eq:unbalanced}
\end{equation} 

The modifications result in a standard optimal transport problem through the
addition of target location $z$ that can receive or deliver $\Delta$ mass at
zero cost to or from any target location.  Thus, the unbalanced optimal
transport can with only minor modifications be solved by fast approximation
algorithms for large data sets such as the Sinkhorn
approach~\cite{cuturi2013sinkhorn} or multiscale
strategies~\cite{gerber2017multiscale}. 

An arbitrary cost $\cost(z, y_j)$ can be assigned to allocate mass, and $z$
does not need to be restricted to only create or remove $\Delta$ amount of
mass, striking a trade-off between the cost of creating mass and the cost of
moving mass. For our application, we choose the allocation of mass at zero cost
but only allow for the allocation of $\Delta$ mass. This forces all mass in the
target location to be matched to a source location location and distribute the
allocated the mass in such a manner that cost of moving the remaining mass is
minimized.

Solving the unbalanced optimal transport problem is convex and yields a global
minimum without any parameter tuning, the only choice to be made is the
selection of a cost $\cost$.

\subsection{Construction of Mass Allocation and Transport Cost Images}
\label{sec:mass}
For an image $X^k$ denote by $X^k(x_i)$ the associated value at voxel location
$x_i$, which defines a measure $\mu^k = \sum_1^n X^k(x_i) \delta(x_i)$.
To construct the voxelwise mass allocation and transport cost measures we solve
for optimal transport plans $\coupling^*_{k,l}$ between all images $X^k$ and $X^l$.  
The variable $z$ in equation~\ref{eq:unbalanced} captures the amount of mass
allocated when moving mass from $X^k$ to $X^l$. Denote by $z_{k, l}$ the mass
allocation variable associated with the optimal transport plan
$\coupling^*_{k,l}$.  By construction $\coupling^*_{k,l}(z_{k,l}, x_i) =
-\coupling^*_{l,k}(z_{l,k}, x_i)$.  For
subject $X_k$ the mass allocation image $M^k$ is constructed by
$M^k(x_i) = \sum_l \coupling^*_{k,l}( z_{k, l}, x_i )$ and the transport cost image by
$C^k(x_i) = \sum_l \sum_j \coupling^*_{k,l}( x_i, x_j ) \cost(x, y)$


The images $M^k$ and $C^k$ are smoothed with a Gaussian with sigma of 3mm and
replace the smoothed intensity or Jacobian determinants in the statistiocal
analysis of a VBM or TBM pipeline. 


\section{Application to OASIS Brain MRI}
\label{sec:results}
We apply the mass allocation and transport cost measures to the OASIS brain
data set~\cite{marcus2010open}.  The OASIS database consists of T1 weighted
MRI of 416 subjects aged 18 to 96. One hundred of the subjects over the age of
60 are diagnosed with mild to moderate dementia. The images in the OASIS data
set are already skull-stripped, gain-field corrected and registered to the
Talaraich atlas space~\cite{talaraich:book88} with a 12-parameter affine
transform.  We restrict the analysis to 137 patients from age 60 to 80, with 66
healthy patents and 71 patients with a diagnosis of very mild to moderate
dementia as established by a clinical dementia rating (CDR, 0 = normal, 0.5 =
very mild, 1 = Mild, 2 = Moderate ), additional to the CDR the data sets
contains information about Age and a mini mental state examination score (MMSE,
count of correct answers with a perfect score of 30).

\begingroup
\renewcommand{\arraystretch}{0}
\setlength{\tabcolsep}{0pt}
\begin{figure}[!h]
\scriptsize
\centering
\begin{tabular}{r}
\begin{tabular}{lrcr}
  \parbox[t][3mm]{20mm}{Pearson's r}&
  \parbox[t][3mm]{7mm}{-0.7} & 
  \includegraphics[width=0.6\linewidth]{colorbar} & 
   \parbox[t][3mm]{6mm}{\hfill 0.7}
\end{tabular}\\
\begin{tabular}{c|cc||cc||cc} 
  \multirow{3}{1mm}{\raisebox{-7mm}{\rotatebox[origin=c]{90}{VBM}} } &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-iW} \\ 
        &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-iW} \\ 
        &
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-iW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-iG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-iW} \\  
  \hline 
  \hline
    \raisebox{1mm}{ \multirow{3}{2mm}{\rotatebox[origin=c]{90}{UTM Cost}} } &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-tW} \\ 
        &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-tW} \\ 
&
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-tW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-tG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-tW} \\ 
  \hline 
  \hline
  \raisebox{1mm}{ \multirow{3}{4mm}{ \rotatebox[origin=c]{90}{UTM Mass} }} &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-axial-age-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-axial-cdr-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-axial-mmse-t-mW} \\ 
        &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-age-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-cdr-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-coronal-mmse-t-mW} \\ 
        &
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-age-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-cdr-t-mW} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-mG} &
\includegraphics[width=0.146\linewidth]{cor-sagital-mmse-t-mW} \\ 

\hline \hline
& \parbox[b][3mm]{12mm}{Age (w)} 
& \parbox[b][3mm]{12mm}{Age (g)} 
& \parbox[b][3mm]{15mm}{CDR (w)} 
& \parbox[b][3mm]{15mm}{CDR (g) }
& \parbox[b][3mm]{15mm}{-MMSE (w)}
& \parbox[b][3mm]{15mm}{-MMSE (g)}
\end{tabular}
\end{tabular}
\caption{\label{fig:cor-oasis}
Correlation of Age, MMSE and CDR with smoothed segmentation mask intensity,
optimal transport mass imbalances and optimal transport costs of gray and white
matter.  Correlations are only shown at locations permutation tested p--value
less than 0.05. The background image are average white and gray matter
segmentations.
\vspace{-5mm}
} 
\end{figure} \endgroup


We construct mass allocation and transport cost images for white and
gray matter segmentation masks individually. We choose here the application to
white and gray matter segmentation masks to separate the changes in each
tissue. However, the method can without modification be applied to any scalar
image or with the definition of a corresponding cost function even to vector or
tensor valued images. For a sensible application the only requirement is that
the measurement at voxels are commensurable across subjects. For the cost
$\cost$ we use the squared euclidean distance between the voxel locations to
introduce a preference of many small mass transports over single larger mass
transfers.  To reduce computation costs, we subsample the images to subsampled
$44 \times 52 \times 44$, which yielded computations times of approximately one
second using the multiscale optimal transport solver described in Gerber et.
al.~\cite{gerber2017multiscale}.

Figure~\ref{fig:cor-oasis} shows voxelwise correlations to Age, negative MMSE
and CDR and compares to a traditional VBM analysis based on intensity. The most
striking difference is that the loss in overall gray matter is immediately
visible in the mass allocation part of the transport based analysis. The
overall loss related to Age is differently distributed from the loss related to
CDR and MMSE. A second striking difference is the loss of white matter around
the ventricles that is significant in CDR and MMSE but not with respect to Age.
The VBM analysis is not capable to discover the global and regionally varying
diminishing of gray and white matter  
%The results on the white matter mask show an increase in the pons area
%correlated with CDR and even MMSE.  A hypointense  T1 signal in the pons area
%has been associated with central pontine myelinolysis, which is linked to
%alcoholism~\cite{quach2014early}. The pons in healthy patients typically
%identified as white matter, the hypointense signal could potentially lead to a
%identification with gray. Similarly, mass allocation indicates significant of
%loss in the brainstem regions which has been reported as a neglected locus in
%neurodegenrative diseases~\cite{grinberg2011brainstem}.  

Table~\ref{fig:prediction} shows results of elastic net
regression~\cite{Zou05regularizationand} on the UTM cost and mass images and
compares to VBM intensity images. We set the elastic net regression penalty
trade-off to $\alpha=0.1$, i.e. larger ridge penalty and smaller sparsity
penality. We report cross-validated root mean square error (CVM) using a
regularization based on selecting the regularization that yielded the minimal
CVM and alternatively the strongest regularization that falls within one
standard deviation of the minimum, as advocated
by~\cite{Zou05regularizationand}. The transport based regression outperforms
the intensity based in all cases.  The minimal regularization appears to
overfit with a much smaller R\textsuperscript{2}  but only a minor reduction in
CVM.  
\begin{table}[h!]
\centering
%\scriptsize
\begin{tabular}{l|cc|cc}
  \parbox[b][4mm]{25mm }{Model  }  &
  \parbox[b][4mm]{15mm }{\centering CVM 1se }  & 
  \parbox[b][4mm]{15mm }{\centering R\textsuperscript{2}  1se} & 
  \parbox[b][4mm]{15mm }{\centering CVM min }  & 
  \parbox[b][4mm]{15mm }{\centering R\textsuperscript{2}  min} 
        \\ \hline \hline
  VBM, Age   & 4.89        & 0.24         & 4.81  & 0.95 \\
  UTM, Age   & {\bf 4.51}  & {\bf 0.39 }  & 4.29  & 0.72 \\ \hline
  VBM, MMSE  & 3.80        & 0.21         & 3.61  & 0.97 \\
  UTM, MMSE  & {\bf3.61 }  & {\bf 0.25}   & 3.27  & 0.54 \\ \hline
  VBM, CDR   & 0.36        & 0.21         & 0.33  & 0.69 \\
  UTM, CDR   & {\bf 0.32 } & {\bf 0.40 }  & 0.30  & 0.72 \\
\end{tabular} 
\caption{ \label{fig:prediction}  Elastic net regression on UTM transport cost
  and mass allocation images versus on VBM intensity images. Reported are
  10-fold crossvalidated root mean square error (CVM) and R\textsuperscript{2}
  with the amount of regularization either selected by the minimal CVM (1se).
  Regression on UTM outperforms VBM on all covariates.
  \vspace{-10mm}}
\end{table}


\section{Conclusion}
The paper demonstrated that UBM can capture changes in size more effectively
than traditional VBM and is insensitive to small misalignments of anatomies in
the spatial normalization step. UBM captures regional and global changes while
retaining the benefits of a voxelwise visualization and analysis of results.
The results in Section~\ref{sec:results} demonstrate the importance of
incorporating mass imbalance into the morphometry framework.  Quantitative
evaluation with linear regression for prediction of clinical parameters suggest
that the transport cost and allocation mass images of UBM provide a richer
description of anatomical changes.

In further research we plan to apply unbalanced optimal transport directly to
gray level intensities or with an appropriate cost function to diffusion
tensors. The cost function offers additional flexibility to be introduced and
we intend to examine the effect of different cost functions and different mass
balancing methods, as mentioned in Section~\ref{sec:unbalanced}, in future work. 

%\footnotesize
\bibliographystyle{abbrv}
\bibliography{bot.bib,optimal-transport}


\end{document}
